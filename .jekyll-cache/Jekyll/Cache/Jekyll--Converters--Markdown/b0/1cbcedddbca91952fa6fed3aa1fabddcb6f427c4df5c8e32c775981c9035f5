I"¬-<p>iOS 10ä»¥åAppleå¯¹IDFAçš„è·å–é€»è¾‘è¿›è¡Œäº†æ›´æ–°</p>

<ul>
  <li>iOS10ä»¥å‰ï¼Œ</li>
  <li>iOS10ä»¥å</li>
</ul>

<p>Djinni æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆè·¨è¯­è¨€çš„ç±»å‹å£°æ˜å’Œæ¥å£ç»‘å®šçš„å·¥å…·ï¼Œä¸»è¦ç”¨äº C++ å’Œ Java ä»¥åŠ Objective-C é—´çš„äº’é€šã€‚</p>

<ul>
  <li>å¥½å¤„ï¼š</li>
  <li>ç”¨äº†æ¥å£æè¿°æ–‡ä»¶ã€‚å£°æ˜æ¸…æ™°ã€ä¿®æ”¹ç®€æ˜“ï¼Œå¹¶ä¿è¯äº†è·¨å¹³å°æ¥å£çš„ä¸€è‡´æ€§ã€‚</li>
  <li>è‡ªåŠ¨ç”Ÿæˆæ¥å£ç»‘å®šä»£ç ã€‚å…å»äº†ç»‘å®š C++ å’Œ Java (JNI) åŠ Objective-C (Objective-C++) çš„éº»çƒ¦ã€‚</li>
</ul>

<h2 id="1-é…ç½®djinni">1 é…ç½®djinni</h2>

<h3 id="11-ä¸‹è½½djinni">1.1 ä¸‹è½½djinni</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/dropbox/djinni.git å°†ä¸‹è½½å¥½çš„djinniæ”¾åœ¨[example_root]/deps/ ä¸‹
</code></pre></div></div>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/1.png" alt="Alt text" /></p>

<h3 id="12-ç¼–è¯‘djinni">1.2 ç¼–è¯‘djinni</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd [djinni_root]/
$ src/build
</code></pre></div></div>

<p><img src="../images/djinni/2.png" alt="Alt text" /></p>

<p>ç¬¬ä¸€æ¬¡ç¼–è¯‘çš„æ—¶å€™ä¼šå»ä¸‹è½½sbté…ç½®</p>

<p>æœ¬äººç³»ç»Ÿç¯å¢ƒæ˜¯macOS Sierra 10.12 , åœ¨æ­¤ç¯å¢ƒä¸‹sbtä¸‹è½½å¤±è´¥ï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥</p>

<p>å¦‚æœsbtä¸‹è½½å¤±è´¥çš„è¯ï¼Œé¡¹ç›®ä¸­æ”¾ç½®äº†ä¸€ä¸ªsbtçš„å‹ç¼©åŒ…ï¼ˆé‡Œè¾¹æ–‡ä»¶é»˜è®¤éšè—çš„ï¼‰ï¼Œå¤åˆ¶é‡Œè¾¹çš„æ–‡ä»¶åˆ°ä½ çš„ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹å°±å¯ä»¥äº†</p>

<h2 id="2-ä½¿ç”¨djinni">2 ä½¿ç”¨djinni</h2>

<h3 id="21-ç¼–å†™djinniæ ¼å¼æ–‡ä»¶">2.1 ç¼–å†™djinniæ ¼å¼æ–‡ä»¶</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hello_world = interface +c {
	static create():hello_world;
	get_hello_world(): string;
	get_name(): string;
	set_name(name:string);
}
</code></pre></div></div>

<p>å‘½åä¸ºhelloworld.djinni å¹¶æ”¾ç½®åœ¨[example_root]/ ä¸‹</p>

<h3 id="22-ç¼–å†™shellæ–‡ä»¶">2.2 ç¼–å†™shellæ–‡ä»¶</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#! /usr/bin/env bash
 
base_dir=$(cd "`dirname "0"`" &amp;&amp; pwd)
cpp_out="$base_dir/generated-src/cpp"
jni_out="$base_dir/generated-src/jni"
objc_out="$base_dir/generated-src/objc"
java_out="$base_dir/generated-src/java/com/mycompany/helloworld"
java_package="com.mycompany.helloworld"
namespace="helloworld"
objc_prefix="HW"
djinni_file="helloworld.djinni"
 
deps/djinni/src/run \
   		--java-out $java_out \
   		--java-package $java_package \
   		--ident-java-field mFooBar \
   		\
   		--cpp-out $cpp_out \
   		--cpp-namespace $namespace \
   		\
   		--jni-out $jni_out \
   		--ident-jni-class NativeFooBar \
   		--ident-jni-file NativeFooBar \
   		\
   		--objc-out $objc_out \
   		--objc-type-prefix $objc_prefix \
   		\
   		--objcpp-out $objc_out \
   		\
   		--idl $djinni_file
</code></pre></div></div>

<p>å‘½åä¸ºrun_djinni.sh å¹¶æ”¾ç½®åœ¨[example_root]/ ä¸‹</p>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/3.png" alt="Alt text" /></p>

<h3 id="23-ç”Ÿæˆæ¥å£ä»£ç ">2.3 ç”Ÿæˆæ¥å£ä»£ç </h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd [example_root]/  
$ sh ./run_djinni.sh
</code></pre></div></div>

<p>è¿è¡ŒæˆåŠŸè¾“å‡ºï¼š</p>

<p><img src="../images/djinni/4.png" alt="Alt text" /></p>

<p>ä»¥åŠç°åœ¨ç›®å½•ç»“æ„ï¼š</p>

<p><img src="../images/djinni/5.png" alt="Alt text" /></p>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼šä¾æ®æè¿°æ–‡ä»¶helloworld.djinniï¼Œåœ¨generated-srcç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿäº§äº† C++ å’Œ Java åŠ Objective-C çš„ç»‘å®šä»£ç ã€‚ç»§ç»­è¦åšçš„ï¼Œåªæ˜¯å†™å®ƒä»¬çš„å…·ä½“å®ç°</p>

<h2 id="3-ç¼–å†™cä»£ç ">3 ç¼–å†™c++ä»£ç </h2>
<h3 id="31-åˆ›å»ºcå·¥ç¨‹">3.1 åˆ›å»ºc++å·¥ç¨‹</h3>
<p>è¿™é‡Œç”¨ XCode åˆ›å»ºä¸€ä¸ª C++ å·¥ç¨‹ï¼Œæ¥æµ‹è¯• C++ æ¥å£ä»£ç ã€‚</p>

<p>é¦–å…ˆï¼Œæ‰“å¼€ XCode ï¼Œé€‰æ‹©â€Create a new Xcode projectâ€ã€‚ç„¶åï¼Œé€‰æ‹©â€Command Line Toolâ€ï¼Œæ¥æ–°å»ºå‘½ä»¤è¡Œå·¥å…·ã€‚</p>

<p><img src="../images/djinni/6.png" alt="Alt text" /></p>

<p>â€œNextâ€åˆ°ä¸‹ä¸€æ­¥æ—¶ï¼Œâ€Languageâ€é€‰æ‹©â€C++â€ã€‚</p>

<p><img src="../images/djinni/7.png" alt="Alt text" /></p>

<p>â€œNextâ€åˆ°ä¸‹ä¸€æ­¥ï¼Œæ”¾åœ¨[example_root]/ ä¸‹</p>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/8.png" alt="Alt text" /></p>

<h3 id="32-ç¼–å†™cå®ç°ä»£ç ">3.2 ç¼–å†™c++å®ç°ä»£ç </h3>

<p>é¦–å…ˆåœ¨[example_root]/ ä¸‹åˆ›å»ºsrc/cppç›®å½•ï¼Œç”¨æ¥å­˜æ”¾c++å®ç°ä»£ç </p>

<p>src/cpp/hello_world_impl.hpp:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#pragma once
 
#include "hello_world.hpp"
 
namespace helloworld {

	class HelloWorldImpl : public helloworld::HelloWorld {
    
	public:
    
    	// Constructor
    	HelloWorldImpl();
    
    	// Our method that returns a string
    	std::string get_hello_world();
    
	};

}
</code></pre></div></div>

<p>src/cpp/hello_world_impl.cpp:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "hello_world_impl.hpp"
#include &lt;string&gt;
 
namespace helloworld {

	std::shared_ptr&lt;HelloWorld&gt; HelloWorld::create() {
	    return std::make_shared&lt;HelloWorldImpl&gt;();
	}
	
	HelloWorldImpl::HelloWorldImpl() {
 	
	}

	std::string HelloWorldImpl::get_hello_world() {
    
 	   std::string myString = "Hello World! ";
    
   	 time_t t = time(0);
   	 tm now=*localtime(&amp;t);
    	char tmdescr[200]={0};
    	const char fmt[]="%r";
    	if (strftime(tmdescr, sizeof(tmdescr)-1, fmt, &amp;now)&gt;0) {
    	    myString += tmdescr;
    	}
    
    	return myString;
    
	}

}
</code></pre></div></div>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/9.png" alt="Alt text" /></p>

<h3 id="33-è°ƒè¯•cä»£ç ">3.3 è°ƒè¯•c++ä»£ç </h3>

<p>æ¥ä¸‹æ¥ï¼ŒæŠŠä»¥ä¸‹ C++ æ¥å£ä»£ç æ–‡ä»¶ï¼Œæ‹–åŠ¨åˆ° Xcode å·¥ç¨‹ç›®å½•æ¥å¼•å…¥(åªéœ€å¼•ç”¨æ–‡ä»¶ï¼Œé¿å…å¤åˆ¶ã€‚)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>generated-src/cpp/hello_world.hpp
src/cpp/hello_world_impl.cpp
src/cpp/hello_world_impl.hpp
</code></pre></div></div>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/10.png" alt="Alt text" /></p>

<p>ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;iostream&gt;
using namespace std;

#include "hello_world_impl.hpp"

int main(int argc, const char * argv[]) {

	helloworld::HelloWorldImpl hw = helloworld::HelloWorldImpl();

	string myString = hw.get_hello_world();
	cout &lt;&lt; myString &lt;&lt; endl;

	return 0;
}
</code></pre></div></div>

<p>è¾“å‡ºä¸º:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World! 02:28:10 PM
</code></pre></div></div>

<p>c++ä»£ç è°ƒè¯•é€šè¿‡</p>

<h2 id="4-ioså·¥ç¨‹">4 iOSå·¥ç¨‹</h2>
<h3 id="41-åˆ›å»ºioså·¥ç¨‹">4.1 åˆ›å»ºioså·¥ç¨‹</h3>

<p>åœ¨[example_root]/ ä¸‹åˆ›å»ºios_projectç›®å½•</p>

<p>Xcodeåˆ›å»ºioså·¥ç¨‹ï¼Œå‘½åä¸ºHelloWorld</p>

<h3 id="42-æ·»åŠ æ–‡ä»¶">4.2 æ·»åŠ æ–‡ä»¶</h3>
<p>å°†ä»¥ä¸‹ç›®å½•ä¸­æ–‡ä»¶åŠ å…¥Xcodeï¼ˆåªå¼•ç”¨ä¸copyï¼‰ï¼Œå¹¶è™šæ‹Ÿç›®å½•åˆ†ç»„ä¸ºocï¼Œc++ï¼Œdjinni</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[example_root]/generated-src/objc/
[example_root]/generated-src/cpp/
[example_root]/scr/cpp/
[example_root]/deps/djinni/support-lib/objc/
</code></pre></div></div>

<p>æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š</p>

<p><img src="../images/djinni/11.png" alt="Alt text" /></p>

<p>å…¶ä¸­</p>

<p>ocæ–‡ä»¶å¤¹ä¸­ä¸ºdjinniç”Ÿæˆçš„æ¥å£æ–‡ä»¶
c++æ–‡ä»¶å¤¹ä¸­ä¸ºdjinniç”Ÿæˆçš„æ¥å£æ–‡ä»¶å’Œæˆ‘ä»¬è‡ªå·±å†™çš„c++å®ç°æ–‡ä»¶
djinniæ–‡ä»¶å¤¹ä¸­ä¸ºè½¬æ¢æ–‡ä»¶ï¼ˆæ‹–å…¥å·¥ç¨‹å°±å¯ä»¥äº†ï¼‰</p>

<h2 id="43-è°ƒè¯•">4.3 è°ƒè¯•</h2>

<p>æ­¤æ—¶æˆ‘ä»¬è°ƒç”¨c++å†™çš„å®ç°ä»£ç ï¼Œåªéœ€è¦è°ƒç”¨æˆ‘ä»¬ocæ–‡ä»¶å¤¹ä¸­çš„æ¥å£æ–‡ä»¶å•¦</p>

<p>é¦–å…ˆå¼•å…¥å¤´æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "HWHelloWorld.h"
</code></pre></div></div>

<p>æ¥ç€è°ƒç”¨ä»£ç </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSString *str = [[HWHelloWorld create] getHelloWorld];
NSLog(@"str:%@",str);
</code></pre></div></div>

<p>è¾“å‡º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World! 02:28:10 PM
</code></pre></div></div>

<p>perfect ï¼ï¼ï¼</p>

<h2 id="é—®ç­”">é—®ç­”</h2>
<p>Qï¼šocå¯ä»¥å’Œc++æ··ç¼–ä¸ºobjective-c++ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ocå’Œc++äº’ç›¸è°ƒç”¨ä¸å°±è¡Œäº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨djinniå‘¢ï¼Ÿ</p>

<p>Aï¼šocå¯ä»¥å’Œc++æ··ç¼–ï¼Œä½†æ˜¯javaæ˜¯éœ€è¦é€šè¿‡jniã€‚æ‰€ä»¥ä½¿ç”¨djinniå°±æ˜¯ä¸ºäº†ç»Ÿä¸€æ¥å£ï¼Œè®©åŒä¸€ä»½c++ä»£ç å¯ä»¥è¢«ocå’Œjavaè°ƒç”¨ï¼Œè®©c++å·¥ç¨‹å¸ˆã€objective-cå·¥ç¨‹å¸ˆã€javaå·¥ç¨‹å¸ˆèƒ½å¤Ÿæ„‰å¿«çš„ä¸€èµ·åˆä½œé¡¹ç›®ã€‚psï¼šå¦‚æœåªæ˜¯å•çº¯çš„æƒ³åœ¨océ‡Œè¾¹æ··ç¼–c++ï¼Œå¯ä»¥å®Œå…¨ä¸ç”¨djinni</p>

<p>Qï¼šä¸Šè¾¹çš„ä¾‹å­ä¸­ï¼Œæ˜¯c++å†™å®ç°ä»£ç ï¼Œjavaå’Œocè°ƒç”¨ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ocå’Œjavaå†™å®ç°ä»£ç ï¼Œc++è°ƒç”¨å‘¢ï¼Ÿ</p>

<p>Aï¼šæå‡ºè¿™ä¸ªé—®é¢˜ï¼Œè¯´æ˜ä½ å¯¹c++è·¨å¹³å°æœ‰ä¸€å®šçš„äº†è§£äº†ã€‚å½“ç„¶å•¦ï¼Œæœ‰è°ƒç”¨ï¼Œå°±æœ‰è¢«è°ƒç”¨ã€‚å¦‚æœä»”ç»†çœ‹çš„ä¸Šè¾¹çš„ä¾‹å­çš„è¯ï¼Œä¼šå‘ç°æˆ‘ä»¬åœ¨helloworld.djinniæ–‡ä»¶ä¸­å®šä¹‰æ¥å£çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„hello_world = interface +c {}ï¼Œé‚£ä¹ˆè¿™ä¸ª+cæ˜¯ä»€ä¹ˆæ„æ€çš„ï¼Œ+cå°±æ˜¯c++æ¥å®ç°ä»£ç ï¼Œä¾›å…¶ä»–å¹³å°è°ƒç”¨ã€‚åè¿‡æ¥æˆ‘ä»¬å¯ä»¥å†™ +j +oï¼Œæ„æ€å°±æ˜¯javaå’Œocå†™å®ç°ä»£ç ï¼Œc++æ¥è°ƒç”¨ã€‚è¿™æ ·å°±å®ç°äº†c++ï¼Œjavaï¼Œocä¹‹é—´çš„äº’ç›¸è°ƒç”¨</p>

<p>Qï¼šdjinniä¸ä¸–é¢ä¸Šçš„H5æŠ€æœ¯è·¨å¹³å°ï¼ŒXamarinè·¨å¹³å°æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>

<p>Aï¼šé¦–å…ˆæ¥å›ç­”djinniå’Œh5ã€Xamarinçš„åŒºåˆ«ã€‚djinniå¯ä»¥è¯´æ˜¯ç”±ä¸‹è‡³ä¸Šçš„è·¨å¹³å°ï¼Œä¸»è¦ç”¨åº•å±‚é€»è¾‘ä»£ç çš„è·¨å¹³å°ï¼Œè€ŒUIåˆ™äº¤ç»™iOSå’Œandroidå¹³å°å»å®Œæˆã€‚h5åˆ™æ˜¯ç”±ä¸Šè‡³ä¸‹çš„è·¨å¹³å°ï¼ŒUIç»Ÿä¸€ï¼Œåº•å±‚é€»è¾‘éœ€è¦iOSå’Œandroidå„è‡ªå¹³å°å»å®ç°ã€‚è€ŒXamarinåˆ™å¯ä»¥è¯´æ˜¯ä¸Šä¸‹é½å‘åŠ›ï¼Œåº•å±‚æ˜¯c#ç¿»è¯‘iosçš„cocoa Touchæ¡†æ¶å’Œandroidæ¡†æ¶ï¼ŒUIç”¨è‡ªåˆ›çš„çš„æ¡†æ¶ç»Ÿä¸€ioså’Œandroidå¹³å°çš„UIã€‚</p>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>

<p>djinniï¼šä¼˜ç‚¹æ˜¯ä¸ä¾èµ–äºIDEï¼Œæ›´åº•å±‚ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œæ›´ç¨³å®šã€‚ç¼ºç‚¹æ˜¯å¾—ä¼šc++ã€‚å¦‚æœå…¬å¸åšæ¸¸æˆçš„ï¼Œé‚£ä¹ˆc++å¤§ç¥åº”è¯¥ä¼šä¸å°‘ï¼ˆç¬”è€…å°±æ˜¯è¿™ä¸ªæƒ…å†µï¼‰</p>

<p>H5ï¼šå‰å‡ å¹´h5æœ€å¤§çš„é—®é¢˜ï¼Œå°±æ˜¯æ€§èƒ½ï¼Œæ¸²æŸ“å¤ªå·®ï¼Œè¿™å‡ å¹´å¥½äº†å¾ˆå¤šã€‚ç¼ºç‚¹æ˜¯å¾ˆå¤šåº•å±‚APIè°ƒç”¨ä¸åˆ°ï¼Œéœ€è¦å„è‡ªå¹³å°å»å®ç°</p>

<p>Xamarinï¼šç¬”è€…æœ‰å¹¸ç ”ç©¶äº†å¤§åŠå¹´çš„Xamarinï¼Œç¿»è¯‘äº†å·²ç»ä¸Šæ¶çš„ä¸€ä¸ªAPPã€‚ä¼˜ç‚¹æ˜¯ç»Ÿä¸€äº†è¯­è¨€c#ã€‚ç¼ºç‚¹æ˜¯æ”¶è´¹ï¼ˆç°åœ¨å·²ç»å…è´¹äº†ï¼‰ï¼Œä¾èµ–IDEï¼Œè¦ç”¨Xamarin Studioæˆ–è€…VSã€‚å¯¹ä¹ æƒ¯äº†Xcodeçš„coderå¯èƒ½æ¯”è¾ƒéš¾æ¥å—ï¼Œå¦å¤–ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ioså’Œandroidå·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„åº“ï¼Œè€Œxamarinæ²¡æœ‰ã€‚æ¯”å¦‚ç¬”è€…è¦æ¥ä¸€ä¸ªæ”¯ä»˜å®æ”¯ä»˜ï¼Œç„¶è€Œå¹¶æ²¡æœ‰è¿™æ ·çš„xamarinåº“ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå·±å»bindingã€‚</p>

<p>æœ€åï¼Œè¿™ä¸ªé—®é¢˜ï¼Œé€‰ä½ é€‚åˆçš„è·¨å¹³å°è§£å†³æ–¹æ¡ˆã€‚</p>

<p>é—®ç­”ä¼šæŒç»­æ›´æ–°å“¦ ï¼ï¼ï¼</p>

<h2 id="æœ€å">æœ€å</h2>

<p>ä¸€ä¸ªæ ¹æ®djinniå†™æˆçš„demoï¼ˆiosï¼‰ï¼Œè§£å†³äº†macOS Sierraä¸‹ç¬¬ä¸€æ¬¡buildæ—¶å‡ºé”™çš„é—®é¢˜</p>

<p>åŸæ–‡åŠdemoæ‰˜ç®¡åœ¨githubä¸Š https://github.com/guojunliu/djinni</p>

<p>å¦‚æœè¿™ç¯‡æ–‡ç« æˆ–è€…demoèƒ½å¸®åˆ°ä½ çš„è¯ï¼Œéº»çƒ¦ç»™ä¸ªStarï¼Œç»™ä¸ªæ˜Ÿæ˜Ÿå“¦ï¼Œèƒ½è®©å®ƒç»§ç»­å¸®åˆ°æƒ³ä½¿ç”¨djinniçš„äºº</p>
:ET