I"q<blockquote>
  <p>2020 å¹´ 6 æœˆ 22 æ—¥ï¼Œè‹¹æœå¬å¼€äº†ç¬¬ä¸€æ¬¡çº¿ä¸Šçš„å¼€å‘è€…å¤§ä¼š - WWDC20ã€‚è¿™æ¬¡å‘å¸ƒä¼šä¸Šå®£å¸ƒäº†ARMæ¶æ„MacèŠ¯ç‰‡ï¼ˆ<del>æ‹³æ‰“Intel</del>ï¼‰ã€iOS 14 ATTï¼ˆ<del>è„šè¸¢Facebook</del>ï¼‰ï¼Œå¯è°“æ˜¯ä¸€æ¬¡å¯ä»¥è½½å…¥å²å†Œï¼ˆ<del>æˆ‘æ˜¯çˆ¸çˆ¸</del>ï¼‰çš„å‘å¸ƒä¼šäº†ï¼Œå½“ç„¶è¿˜å‘å¸ƒäº†è¢«ç§°ä¸ºä¸‹ä¸€ä¸ªé¡¶çº§æµé‡å…¥å£çš„<code class="language-plaintext highlighter-rouge">Widget</code>ã€‚</p>

  <p>è¸©ç€å…«æœˆçš„å°¾å·´ï¼Œæœ¬æ¬¡æˆ‘ä»¬å°±æ¥æ¢ç©¶ä¸€ä¸‹Widget</p>

  <p>æœ¬æ–‡ä¼šä»<code class="language-plaintext highlighter-rouge">Widgetåˆçª¥</code>å’Œ<code class="language-plaintext highlighter-rouge">Widgetå¼€å‘</code>ä¸¤ä¸ªç»´åº¦æ¥æ¢ç©¶ä¸€ä¸‹Widgetï¼Œ
å…¶ä¸­<code class="language-plaintext highlighter-rouge">åˆçª¥</code>ä¼šå¸¦æ‚¨ç®€å•çš„äº†è§£ä¸€ä¸‹Widgetï¼Œé€‚åˆåº”ç”¨å†³ç­–è€…é˜…è¯»ï¼›
<code class="language-plaintext highlighter-rouge">å¼€å‘</code>ä¼šå¸¦ç€æ‚¨ä¸€æ­¥ä¸€æ­¥çš„å®Œæˆè®¾è®¡å¼€å‘Widgetï¼Œé€‚åˆç¨‹åºå‘˜é˜…è¯»ã€‚</p>
</blockquote>

<h1 id="widgetåˆçª¥">Widgetåˆçª¥</h1>

<h2 id="ä¸€widgetæ˜¯ä»€ä¹ˆ">ä¸€ã€Widgetæ˜¯ä»€ä¹ˆ</h2>

<blockquote>
  <p>In iOS 14, we have a dramatic new Home screen experience, one that is much more dynamic and personalized, with a focus on widgets.
The content is the focus.
This is very important: <code class="language-plaintext highlighter-rouge">widgets are not mini-apps.</code>
Think of this as more projecting content from your app onto the Home screen rather than full mini-apps filled with tiny little buttons.</p>
</blockquote>

<p>ç®€å•æ¥è¯´Widgetä¸æ˜¯è¿·ä½ åº”ç”¨ç¨‹åºã€‚è€Œæ˜¯ä¸€ç§æ–°çš„ä¸»å±å¹•ä½“éªŒï¼Œèƒ½å¿«é€Ÿæä¾›ç”¨æˆ·å…³å¿ƒçš„å†…å®¹æ˜¯é‡ç‚¹</p>

<p><br /></p>

<h2 id="äºŒwidgetçš„ç‰¹ç‚¹">äºŒã€Widgetçš„ç‰¹ç‚¹</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Glanceable</code>		ä¸€ç›®äº†ç„¶</li>
  <li><code class="language-plaintext highlighter-rouge">Relevant</code>			æ—©éŸ­æ™šè˜</li>
  <li><code class="language-plaintext highlighter-rouge">Personalized</code>		é‡ä½“è£è¡£</li>
</ul>

<p><img src="../images/widget/0.png" alt="Alt text" /></p>

<p>è¦è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Widgetï¼Œå°±è¦å…ˆäº†è§£Widgetçš„å…¨éƒ¨ç‰¹ç‚¹ï¼Œäº†ç„¶äºèƒ¸</p>

<p>é’ˆå¯¹Appleæå‡ºçš„<code class="language-plaintext highlighter-rouge">Glanceable</code>ã€<code class="language-plaintext highlighter-rouge">Relevant</code>ã€<code class="language-plaintext highlighter-rouge">Personalized</code>åˆ†åˆ«ç”¨ä¸€ä¸ªæˆè¯­æ¥å½¢å®¹å°±æ˜¯<code class="language-plaintext highlighter-rouge">ä¸€ç›®äº†ç„¶</code>ã€<code class="language-plaintext highlighter-rouge">æ—©éŸ­æ™šè˜</code>ã€<code class="language-plaintext highlighter-rouge">é‡ä½“è£è¡£</code></p>

<p>ç®€å•æ¥è¯´ä¸‹è¿™å‡ ä¸ªç‰¹ç‚¹</p>

<p><br /></p>

<h3 id="1glanceable--ä¸€ç›®äº†ç„¶ä¸€è§ˆæ— ä½™">1ã€Glanceable | ä¸€ç›®äº†ç„¶ï¼Œä¸€è§ˆæ— ä½™</h3>

<p><img src="../images/widget/1.png" alt="Alt text" /></p>

<p>ä¸€ä¸ªä¼˜ç§€çš„Widgetè¦æ˜¯ä¸€ç›®äº†ç„¶ï¼Œä¸€è§ˆæ— ä½™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>

<p>æ™®é€šäººæ¯å¤©è¿›å…¥â€œä¸»å±å¹•â€çš„æ¬¡æ•°è¶…è¿‡90æ¬¡ï¼Œä½†æ˜¯åœ¨ä¸»å±å¹•ä»…åœç•™å‡ åˆ†é’Ÿï¼Œå°±åˆ‡æ¢åˆ°å…¶ä»–Appäº†ã€‚</p>

<p>æ‰€ä»¥Widgetä¸€å®šè¦å……åˆ†åˆ©ç”¨ç‹­å°çš„å±å¹•å±•ç¤ºæœ€æ ¸å¿ƒçš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¦ç®€æ´æ˜äº†ã€‚è®¾è®¡æ–°é¢–ï¼Œä¾¿äºå¿«é€Ÿæµè§ˆï¼Œé«˜æ•ˆæ˜¯ä¸€ä¸ªä¼˜ç§€Widgetçš„æ ¸å¿ƒã€‚</p>

<p>ç”¨æˆ·ä¸ç”¨æ€è€ƒè¿™ä¸ªWidgetæ€ä¹ˆä½¿ç”¨ï¼Œä¸éœ€è¦ç‚¹å‡»ä»»ä½•æŒ‰é’®å°±å¯ä»¥è·å¾—æœ€å…³å¿ƒçš„ä¿¡æ¯ã€‚</p>

<p><br /></p>

<h3 id="2relevant--æ—©éŸ­æ™šè˜é‡ä½“è£è¡£">2ã€Relevant | æ—©éŸ­æ™šè˜ï¼Œé‡ä½“è£è¡£</h3>

<p><img src="../images/widget/2.png" alt="Alt text" /></p>

<p>è‹¹æœå¸Œæœ›Widgetå¯ä»¥å’Œç”¨æˆ·ç´§å¯†ç»“åˆï¼Œä¸ç”¨æˆ·çš„è¡Œä¸ºæ‰€å…³è”ï¼Œæ¯”å¦‚æ—©ä¸Šèµ·åºŠï¼Œç”¨æˆ·å¸Œæœ›çœ‹ä¸€ä¸‹å¤©æ°”ï¼›ä¸­åˆæ°é¥­ï¼Œç”¨æˆ·å¸Œæœ›æœ‰äººæ¨èä¸‹é™„è¿‘çš„ç¾é£Ÿï¼›æ™šé«˜å³°çš„æ—¶å€™ï¼Œç”¨æˆ·å¸Œæœ›äº†è§£ä¸€ä¸‹è¡Œè½¦è·¯çº¿ï¼›æ™šå®‰çš„æ—¶å€™ï¼Œå¸Œæœ›è®°å½•ä¸‹æ¬¡æ—¥çš„è¡Œç¨‹ã€‚</p>

<p>ä¸ºæ­¤ï¼Œè‹¹æœç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå«Smart Stacksï¼ˆæ™ºèƒ½å æ”¾ï¼‰çš„åŠŸèƒ½ï¼ŒSmart Stacksæ˜¯ä¸€ä¸ªWidgetsçš„é›†åˆã€‚ç³»ç»Ÿä¼šæ ¹æ®æ¯ä¸ªäººçš„ä¹ æƒ¯ï¼Œè‡ªåŠ¨æ˜¾ç¤ºç”¨æˆ·å½“å‰æ—¶é—´ç‚¹æœ€éœ€è¦çš„Widgetã€‚</p>

<div style="align:center"><img src="../images/widget/3.gif" /></div>

<p><br /></p>

<h3 id="3personalized--ä¸ªæ€§åŒ–">3ã€Personalized  ä¸ªæ€§åŒ–</h3>

<h4 id="31-å¤§å°">3.1 å¤§å°</h4>

<p>Widgetè¦èƒ½ä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„æœåŠ¡ï¼Œæ¯”å¦‚å¤©æ°”Widgetï¼Œéœ€è¦èƒ½ä¸ºä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒç»†èŠ‚çš„å¤©æ°”æƒ…å†µã€‚</p>

<p><img src="../images/widget/4.png" alt="Alt text" /></p>

<p>ä¸ºæ­¤Appleæä¾›ä¸‰ç§ä¸åŒå¤§å°çš„å°éƒ¨ä»¶</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">systemSmall</code></li>
  <li><code class="language-plaintext highlighter-rouge">systemMedium</code></li>
  <li><code class="language-plaintext highlighter-rouge">systemLarge</code></li>
</ul>

<p>å…¶ä¸­systemSmallå¤§å°ä¸º<code class="language-plaintext highlighter-rouge">2*2 Icon</code>ï¼ŒsystemMediumå¤§å°ä¸º<code class="language-plaintext highlighter-rouge">4*2 Icon</code>ï¼ŒsystemLargeå¤§å°ä¸º<code class="language-plaintext highlighter-rouge">4*4 Icon</code>ï¼Œå…·ä½“çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹</p>

<p><img src="../images/widget/13.png" alt="Alt text" /></p>

<h4 id="32-ä¸ªæ€§åŒ–é…ç½®">3.2 ä¸ªæ€§åŒ–é…ç½®</h4>

<p>å¦ä¸€æ–¹é¢Widgetéœ€è¦èƒ½ä¸ºä¸åŒåŸå¸‚çš„ç”¨æˆ·æä¾›å½“åœ°çš„å¤©æ°”æƒ…å†µã€‚</p>

<p>ä¸ºæ­¤Appleåœ¨åˆ›å»ºWidgetæ—¶ä¸ºå¼€å‘è€…æä¾›äº†ä¸¤ç§ç±»å‹ï¼š</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">StaticConfiguration</code> ï¼šå¯¹äºæ²¡æœ‰ç”¨æˆ·å¯é…ç½®å±æ€§çš„çª—å£å°éƒ¨ä»¶,ä¹Ÿå°±æ˜¯ç”¨æˆ·æ— éœ€é…ç½®ï¼Œå±•ç¤ºçš„å†…å®¹åªå’Œç”¨æˆ·ä¿¡æ¯æœ‰å…³ç³»ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºä¸€èˆ¬å¸‚åœºä¿¡æ¯çš„è‚¡å¸‚çª—å£å°éƒ¨ä»¶ï¼Œæˆ–æ˜¾ç¤ºè¶‹åŠ¿å¤´æ¡çš„æ–°é—»çª—å£å°éƒ¨ä»¶ã€‚</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">IntentConfiguration</code> ï¼šå¯¹äºå…·æœ‰ç”¨æˆ·å¯é…ç½®å±æ€§çš„çª—å£å°éƒ¨ä»¶,ä¹Ÿå°±æ˜¯æ”¯æŒç”¨æˆ·é…ç½®åŠç”¨æˆ·æ„å›¾çš„æ¨æµ‹ã€‚æ‚¨ä½¿ç”¨SiriKitè‡ªå®šä¹‰æ„å›¾æ¥å®šä¹‰å±æ€§ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä¸€ä¸ªåŸå¸‚çš„é‚®æ”¿ç¼–ç çš„å¤©æ°”å°éƒ¨ä»¶ï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªè·Ÿè¸ªå·çš„åŒ…è£¹è·Ÿè¸ªå°éƒ¨ä»¶ã€‚</p>
  </li>
</ul>

<p><img src="../images/widget/11.png" alt="Alt text" /></p>

<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒIntentConfigurationå¹¶ä¸éœ€è¦ç¼–å†™ä»£ç ï¼Œåªéœ€è¦ç®€å•çš„é…ç½®ï¼ŒXcode ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆå¯¹åº”çš„ä»£ç å’Œç±»å‹ã€‚</p>

<h4 id="33-é»‘æš—æ¨¡å¼">3.3 é»‘æš—æ¨¡å¼</h4>

<p>æ­¤å¤–Widgetè¿˜æ”¯æŒç³»ç»Ÿçš„é»‘æš—æ¨¡å¼</p>

<p><img src="../images/widget/12.png" alt="Alt text" /></p>

<p><br /></p>

<h2 id="ä¸‰widgetçš„æœ¬è´¨">ä¸‰ã€Widgetçš„æœ¬è´¨</h2>

<p>Widgetçš„æœ¬è´¨æ˜¯ä¸€ç³»åˆ—é™æ€è§†å›¾å †å è€Œæˆçš„é›†åˆï¼Œä¸åŒçš„æ—¶é—´ç‚¹å±•ç¤ºä¸åŒçš„è§†å›¾</p>

<p>è¿™é‡Œè¦å¼•å…¥Widgetçš„æ ¸å¿ƒTimeline</p>

<p>é¡¾åæ€ä¹‰ï¼ŒTimelineå°±æ˜¯ä¸€æ¡æ—¶é—´çº¿ï¼Œåœ¨å¯¹åº”çš„æ—¶é—´ç‚¹å‘ç”Ÿå¯¹åº”çš„äº‹ä»¶</p>

<p>è®¸å¤šWidgetå…·æœ‰å¯é¢„æµ‹çš„æ—¶é—´ç‚¹ï¼Œåœ¨è¿™äº›æ—¶é—´ç‚¹æ›´æ–°å…¶å†…å®¹æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºå¤©æ°”ä¿¡æ¯çš„å°éƒ¨ä»¶å¯èƒ½ä¼šåœ¨ä¸€æ•´å¤©å†…æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡æ¸©åº¦ã€‚è‚¡å¸‚çª—å£å°éƒ¨ä»¶å¯ä»¥åœ¨å…¬å¼€å¸‚åœºæ—¶é—´é¢‘ç¹æ›´æ–°å…¶å†…å®¹ï¼Œä½†å‘¨æœ«åˆ™ä¸èƒ½å®Œå…¨æ›´æ–°ã€‚é€šè¿‡æå‰è®¡åˆ’è¿™äº›æ—¶é—´ï¼Œç”Ÿæˆä¸åŒçš„è§†å›¾æ”¾å…¥æ—¶é—´çº¿ä¸­ï¼ŒWidgetKitä¼šåœ¨é€‚å½“çš„æ—¶é—´åˆ°æ¥æ—¶è‡ªåŠ¨åˆ·æ–°æ‚¨çš„çª—å£å°éƒ¨ä»¶ã€‚</p>

<p>è¿™ä¹Ÿå†³å®šäº†WidgetåŸºæœ¬ä¸Šä¸èƒ½å®æ—¶æ›´æ–°</p>

<p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒWidgetKitä¼šæŠŠ Timelines æ‰€å®šä¹‰çš„Views ç»“æ„ä¿¡æ¯ç¼“å­˜åˆ°ç£ç›˜ï¼Œç„¶ååœ¨åˆ·æ–°çš„æ—¶å€™æ‰é€šè¿‡ JIT çš„æ–¹å¼æ¥æ¸²æŸ“ã€‚è¿™ä½¿å¾—ç³»ç»Ÿå¯ä»¥åœ¨æä½ç”µé‡å¼€é”€ä¸‹ä¸ºä¼—å¤š Widgets å¤„ç† Timelines ä¿¡æ¯ã€‚</p>

<p><img src="../images/widget/6.png" alt="Alt text" /></p>

<p><br /></p>

<h2 id="å››ç”¨æˆ·äº¤äº’">å››ã€ç”¨æˆ·äº¤äº’</h2>

<p>ä¸å¥½æ„æ€ï¼Œæ²¡æœ‰äº¤äº’ï¼ï¼ï¼</p>

<p>ä¸ºäº†å®ç°ä»¥ä¸Šçš„ç‰¹ç‚¹ï¼ŒAppleä¹Ÿç§»é™¤é™åˆ¶äº†Widgetçš„ä¸€äº›åŠŸèƒ½</p>

<ul>
  <li>ä¸èƒ½äº¤äº’</li>
  <li>ä¸èƒ½æ’­æ”¾åŠ¨ç”»</li>
  <li>ä¸èƒ½æ’­æ”¾è§†é¢‘</li>
  <li>ä¸æ”¯æŒæ»šåŠ¨</li>
  <li>ä¸æ”¯æŒä¸»åŠ¨åˆ·æ–°è§†å›¾</li>
</ul>

<p>å”¯ä¸€æ”¯æŒçš„åªæœ‰ç”¨æˆ·ç‚¹å‡»Widgetå”¤èµ·ä¸»App</p>

<p><img src="../images/widget/5.png" alt="Alt text" /></p>

<p>å…¶ä¸­ç‚¹å‡»å”¤èµ·ä¸»Appæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ï¼š</p>

<ul>
  <li>widgetURL</li>
  <li>Link</li>
</ul>

<p>widgetURLå”¤èµ·Appçš„ç‚¹å‡»åŒºåŸŸæ˜¯Widgetçš„æ‰€æœ‰åŒºåŸŸï¼Œè¿™ç§æ–¹æ¡ˆé€‚åˆç®€å•å…ƒç´ ï¼Œå•ä¸€é€»è¾‘çš„å°éƒ¨ä»¶</p>

<p><img src="../images/widget/8.png" alt="Alt text" /></p>

<p>å¯¹äºsystemSmallç±»å‹çš„å°éƒ¨ä»¶ï¼Œåªæ”¯æŒwidgetURLå”¤èµ·æ–¹å¼</p>

<p>é’ˆå¯¹<code class="language-plaintext highlighter-rouge">systemMedium </code>å’Œ<code class="language-plaintext highlighter-rouge">systemLarge </code>è¿˜å¯ä»¥ä½¿ç”¨æ›´ç»†åˆ†çš„Linkå”¤èµ·æ–¹å¼ï¼Œè¿™ç§å”¤èµ·æ–¹å¼èƒ½è®©å°éƒ¨ä»¶é€šè¿‡ä¸åŒå…ƒç´ çš„ç‚¹å‡»å”¤èµ·Appçš„ä¸åŒé¡µé¢ï¼Œè®©å¼€å‘è€…æœ‰æ›´å¤šçš„æ–½å±•ç©ºé—´</p>

<p><img src="../images/widget/9.png" alt="Alt text" /></p>

<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼ŒwidgetURLå¯åº”ç”¨äºå¤©æ°”å°éƒ¨ä»¶ï¼Œåšå®¢å°éƒ¨ä»¶ï¼Œç‚¹å‡»ç›´è¾¾Appï¼›</p>

<p>Linkå¯ç”¨äºå¤‡å¿˜å½•å’Œæ—¥å†å°éƒ¨ä»¶ï¼Œç‚¹å‡»ä¸åŒçš„å¤‡å¿˜å½•å’Œæ—¥æœŸç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„å¤‡å¿˜å½•è¯¦æƒ…å’Œä»£åŠè¯¦æƒ…é¡µé¢</p>

<p><img src="../images/widget/10.png" alt="Alt text" /></p>

<p><br /></p>

<h2 id="widgetåˆçª¥æ€»ç»“">Widgetåˆçª¥æ€»ç»“</h2>

<p>Widgetçš„å‡ºç°çŠ¹å¦‚åœ¨ä¸€æ½­æ­»æ°´çš„iOSæ¡Œé¢ä¸Šæ³›èµ·äº†ä¸€ç‰‡æ¶Ÿæ¼ªï¼Œä¸€å®šä¼šæœ‰å¾ˆå¤šAppæ¥äº‰å¤ºè¿™å—è‚¥è‚‰ä¸€èˆ¬çš„æµé‡å…¥å£ã€‚</p>

<p>ä½†æ˜¯ä»”ç»†ç ”ç©¶ä¸€ä¸‹ä¼šå‘ç°ï¼ŒAppleè¿™æ¬¡æ¨å‡ºçš„Widgetéå¸¸å…‹åˆ¶ï¼Œå¹¶æ²¡æœ‰éå¸¸æ¿€è¿›ï¼Œ</p>

<p>ä¿—è¯è¯´ï¼šå–œæ¬¢æ˜¯æ”¾è‚†,ä½†çˆ±å°±æ˜¯å…‹åˆ¶ã€‚è¿™é‡Œä¸å¾—ä¸å†æ¬¡å¼•ç”¨Appleåœ¨Widgetä»‹ç»ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„è¯<code class="language-plaintext highlighter-rouge">widgets are not mini-apps</code>ï¼Œå› ä¸ºWidgetåœ¨è®¾è®¡ä¹‹åˆå°±æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨æœ€å°‘çš„æˆæœ¬ï¼Œå‘ç”¨æˆ·æä¾›æœ€æ ¸å¿ƒçš„ä¿¡æ¯ã€‚ä¸ºäº†å°½å¯èƒ½çš„å‡å°‘ç”¨æˆ·æˆæœ¬ï¼ˆç”µé‡ï¼Œç½‘ç»œç­‰ï¼‰å’Œæé«˜ç”¨æˆ·ä½“éªŒï¼ŒAppleåœ¨æŠ€æœ¯å±‚é¢ä¸Šåšäº†å¾ˆå¤šé™åˆ¶ï¼Œé™åˆ¶äº†éå¸¸å¤šçš„åŠŸèƒ½ï¼Œå¤§å¤§å‰Šå¼±äº†Widgetçš„åœ°ä½å’Œé‡è¦ç¨‹åº¦ï¼Œä¹Ÿé™ä½äº†å¼€å‘è€…å®ç°çš„çƒ­æƒ…å’Œç§¯ææ€§</p>

<p>å…¶å®æ¯å¹´Appleæ›´æ–°çš„æ–°æŠ€æœ¯åªæœ‰å¾ˆå°‘çš„ä¸€éƒ¨åˆ†èƒ½åº”ç”¨åˆ°Appä¸Šï¼Œå¸Œæœ›è¿™æ¬¡çš„Widgetèƒ½æœ‰åŠ¨åŠ›è®©å¤§å®¶ç»“åˆè‡ªå·±çš„Appï¼Œç»™è‡ªå·±çš„Appå¸¦æ¥æ›´å¤šçš„æµé‡ï¼Œä¹Ÿèƒ½ç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒã€‚</p>

<hr />
<hr />

<p><br /></p>

<h1 id="widgetå¼€å‘">Widgetå¼€å‘</h1>

<p>é‡å¤´æˆæ¥å•¦ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è®¾è®¡ç¼–å†™å‡ºä¼˜ç§€çš„å°éƒ¨ä»¶å§</p>

<p>å¼€å§‹ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬è¦ä»‹ç»ä¸‹Widgetçš„å¼€å‘è¯­è¨€ï¼ŒAppleç‰¹åˆ«æŒ‡å®šäº†å°éƒ¨ä»¶åªèƒ½ä½¿ç”¨SwiftUIæ¥å¼€å‘</p>

<h2 id="ä¸€swiftui">ä¸€ã€SwiftUI</h2>

<p><img src="../images/widget/14.png" alt="Alt text" /></p>

<p>ç°åœ¨iOSä¸»æµçš„å¼€å‘è¯­è¨€è¿˜æ˜¯Objective-Cï¼Œé‚£Appleä¸ºä»€ä¹ˆè¦é€‰æ‹©2019 WWDCå‘å¸ƒè¿„ä»Šä¸ºæ­¢åªæœ‰ä¸€å¹´çš„SwiftUIå‘¢ï¼Ÿ</p>

<p>é¦–å…ˆï¼Œä»ä¸€å¼€å§‹å°±å°†å°éƒ¨ä»¶å®ç°å¤šå¹³å°åŒ–æ˜¯Appleçš„ä¸€ä¸ªç›®æ ‡ï¼ŒSwiftUIåœ¨è·¨è®¾å¤‡å±•ç¤ºçš„èƒ½åŠ›ä¸Šæ˜¯ä¸€æŠŠå¤§æ€å™¨ï¼›</p>

<p>å…¶æ¬¡SwiftUIè¿˜ä½¿è‡ªåŠ¨å¸ƒå±€å’Œæš—æ¨¡å¼ç­‰åŠŸèƒ½å˜å¾—éå¸¸å®¹æ˜“ï¼Œé™ä½äº†é€‚é…ç­‰å¼€å‘æˆæœ¬ï¼Œå¯¹ä¸éœ€è¦å¤ªå¤šå…ƒç´ çš„å°éƒ¨ä»¶æ¥è¯´ï¼ŒSwiftUIé‡ç‚¹å…³æ³¨å¸ƒå±€çš„ç‰¹ç‚¹æ— ç–‘æ˜¯æœ€åˆé€‚çš„ï¼›</p>

<p>ä»å¦ä¸€æ–¹é¢æ¥è®²ï¼Œåªæœ‰ä½¿ç”¨ SwiftUI æ‰èƒ½è¾¾åˆ°æˆ‘ä»¬ä¸Šè¾¹è¯´çš„å¯¹äº Widget çš„é™åˆ¶ã€‚å¦‚æœå¯ä»¥ä½¿ç”¨ Objective-C UIKit çš„è¯ï¼Œæˆ‘ä»¬å¼ºå¤§çš„å¼€å‘è€…å¯èƒ½ä¼šæƒ³å‡ºæ— æ•°çš„é»‘ç§‘æŠ€æ¥å¿½ç•¥AppleçœŸçš„å°éƒ¨ä»¶çš„é™åˆ¶ã€‚æ¯”å¦‚å¼€å‘æ— æ³•ä½¿ç”¨ UIViewRepresentable æ¥æ¡¥æ¥ UIKitï¼›</p>

<p>æœ€åAppleä¹Ÿå¤¹å¸¦äº†è‡ªå·±çš„ç§å¿ƒï¼ŒAppleä»Šå¹´å·²ç»å°† Swift è¯­è¨€å’Œ SwiftUI çš„é‡è¦ç¨‹åº¦æå‡åˆ°äº†ä¸€ä¸ªæ–°çš„é«˜åº¦ï¼ŒSwiftå·²ç»å¯ä»¥ç‹¬ç«‹äºFoundtionæ¡†æ¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„SwiftUIä¹Ÿåº”è¯¥ä¸ä¾èµ–äºUIKitæ¡†æ¶äº†ï¼Œå¼ºè¡Œä½¿ç”¨SwiftUIå¯ä»¥ä½¿å¼€å‘äººå‘˜å°½å¯èƒ½å®¹æ˜“åœ°å°†å…¶å­¦ä¹ å…¶å†…å®¹å¹¶åº”ç”¨äºiOSï¼ŒiPadOSå’ŒmacOSï¼Œ</p>

<p>æ¯•ç«Ÿ5æœˆä»½å¡ä½ç¬¬20ä½Objective-Cåœ¨6æœˆä»½å·²ç»è·Œå‡ºäº†å‰20</p>

<p><img src="../images/widget/16.png" alt="Alt text" /></p>

<p>è¿™é‡Œè¦é‡ç‚¹è¯´æ˜ä¸€ä¸‹ï¼ŒWidgetåªè¦ä½¿ç”¨ä»»ä½• UIKit çš„å…ƒç´ å°±ä¼šç›´æ¥ Crash</p>

<p><br /></p>

<h2 id="äºŒå°†å°éƒ¨ä»¶ç›®æ ‡æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨">äºŒã€å°†å°éƒ¨ä»¶ç›®æ ‡æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨</h2>

<p>çª—å£å°éƒ¨ä»¶æ‰©å±•æ¨¡æ¿æä¾›äº†åˆ›å»ºçª—å£å°éƒ¨ä»¶çš„èµ·ç‚¹ã€‚å•ä¸ªå°éƒ¨ä»¶æ‰©å±•å¯ä»¥åŒ…å«å¤šç§å°éƒ¨ä»¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä½“è‚²åº”ç”¨ç¨‹åºå¯èƒ½æœ‰ä¸€ä¸ªæ˜¾ç¤ºå›¢é˜Ÿä¿¡æ¯çš„å°éƒ¨ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¾ç¤ºæ¸¸æˆæ—¶é—´è¡¨çš„å°éƒ¨ä»¶ã€‚ä¸€ä¸ªå°éƒ¨ä»¶æ‰©å±•å¯ä»¥åŒ…å«ä¸¤ä¸ªå°éƒ¨ä»¶ã€‚å°½ç®¡å»ºè®®å°†æ‰€æœ‰çª—å£å°éƒ¨ä»¶åŒ…å«åœ¨ä¸€ä¸ªçª—å£å°éƒ¨ä»¶æ‰©å±•ä¸­ï¼Œä½†å¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªæ‰©å±•ã€‚</p>

<ol>
  <li>
    <p>åœ¨Xcodeä¸­æ‰“å¼€æ‚¨çš„åº”ç”¨ç¨‹åºé¡¹ç›®ï¼Œç„¶åé€‰æ‹©â€œæ–‡ä»¶â€&gt;â€œæ–°å»ºâ€&gt;â€œç›®æ ‡â€ã€‚</p>
  </li>
  <li>
    <p>ä»â€œåº”ç”¨ç¨‹åºæ‰©å±•â€ç»„ä¸­ï¼Œé€‰æ‹©â€œçª—å£å°éƒ¨ä»¶æ‰©å±•â€ï¼Œç„¶åå•å‡»â€œä¸‹ä¸€æ­¥â€ã€‚</p>
  </li>
  <li>
    <p>è¾“å…¥æ‚¨çš„åŒ…åã€‚</p>
  </li>
  <li>
    <p>å¦‚æœçª—å£å°éƒ¨ä»¶æä¾›äº†ç”¨æˆ·å¯é…ç½®çš„å±æ€§ï¼Œè¯·é€‰ä¸­<code class="language-plaintext highlighter-rouge">Include Configuration Intent</code>å¤é€‰æ¡†ã€‚</p>
  </li>
</ol>

<p>å•å‡»å®Œæˆã€‚</p>

<p><img src="../images/widget/15.png" alt="Alt text" /></p>

<blockquote>
  <p>é‡ç‚¹ï¼šå°éƒ¨ä»¶ä¸ä»…æ”¯æŒSwifté¡¹ç›®ï¼ŒåŒæ ·ä¹Ÿæ”¯æŒObjective-Cé¡¹ç›®ï¼ŒOCå°ä¼™ä¼´ä¸ç”¨æ‹…å¿ƒå•¦</p>
</blockquote>

<p>åˆ›å»ºå®Œå°éƒ¨ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä¼šå¤šå‡ºä¸€ä¸ªSmileEverydayWidget.swiftæ–‡ä»¶ï¼Œè¿™å·²ç»æ˜¯ä¸€ä¸ªå¯ä»¥runèµ·æ¥çš„å°éƒ¨ä»¶äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥è¦é€ä¸ªæ–¹æ³•æ¥åˆ†æï¼Œæ‰€ä»¥å°†æ–‡ä»¶å…¨æ–‡å±•ç¤ºå¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//
//  SmileEverydayWidget.swift
//  SmileEverydayWidget
//
//  Created by steve on 2020/8/28.
//

import WidgetKit
import SwiftUI

struct Provider: TimelineProvider {
    public typealias Entry = SimpleEntry

    public func snapshot(with context: Context, completion: @escaping (SimpleEntry) -&gt; ()) {
        let entry = SimpleEntry(date: Date())
        completion(entry)
    }

    public func timeline(with context: Context, completion: @escaping (Timeline&lt;Entry&gt;) -&gt; ()) {
        var entries: [SimpleEntry] = []

        // Generate a timeline consisting of five entries an hour apart, starting from the current date.
        let currentDate = Date()
        for hourOffset in 0 ..&lt; 5 {
            let entryDate = Calendar.current.date(byAdding: .hour, value: hourOffset, to: currentDate)!
            let entry = SimpleEntry(date: entryDate)
            entries.append(entry)
        }

        let timeline = Timeline(entries: entries, policy: .atEnd)
        completion(timeline)
    }
}

struct SimpleEntry: TimelineEntry {
    public let date: Date
}

struct PlaceholderView : View {
    var body: some View {
        Text("Placeholder View")
    }
}

struct SmileEverydayWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        Text(entry.date, style: .time)
    }
}

@main
struct SmileEverydayWidget: Widget {
    private let kind: String = "SmileEverydayWidget"

    public var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider(), placeholder: PlaceholderView()) { entry in
            SmileEverydayWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("My Widget")
        .description("This is an example widget.")
    }
}

struct SmileEverydayWidget_Previews: PreviewProvider {
    static var previews: some View {
        /*@START_MENU_TOKEN@*/Text("Hello, World!")/*@END_MENU_TOKEN@*/
    }
}
</code></pre></div></div>

<p>è¿™é‡Œçš„æ¦‚å¿µå’Œä»£ç æ¯”è¾ƒå¤šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥è§£é‡Š</p>

<p><br /></p>

<h2 id="ä¸‰widget-api">ä¸‰ã€Widget API</h2>

<p>é¦–å…ˆæˆ‘ä»¬ä»å¸¦æœ‰<code class="language-plaintext highlighter-rouge">main</code>å­—æ®µçš„æ–¹æ³•æ¥è¯´èµ·ï¼Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@main
struct SmileEverydayWidget: Widget {
    private let kind: String = "com.steve.liu.smileEverydayWidget"

    public var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider(), placeholder: PlaceholderView()) { entry in
            SmileEverydayWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("My Widget")
        .description("This is an example widget.")
        .supportedFamilies([.systemSmall, .systemMedium, .systemLarge])
    }
}
</code></pre></div></div>

<p>å¤§å®¶éƒ½çŸ¥é“å¸¦æœ‰<code class="language-plaintext highlighter-rouge">main</code>æ ‡è¯†çš„æ–¹æ³•éƒ½æ˜¯ç¨‹åºçš„å…¥å£</p>

<p>è¿™æ®µä»£ç ä½¿ç”¨SwiftUIå£°æ˜äº†ä¸€ä¸ªåä¸ºSmileEverydayWidgetçš„å°éƒ¨ä»¶ï¼Œå…¶ä¸­<code class="language-plaintext highlighter-rouge">StaticConfiguration</code>æ˜¯å°éƒ¨ä»¶çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå®ƒæœ‰å‡ ä¸ªå‚æ•°ï¼š</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">kind</code></li>
  <li><code class="language-plaintext highlighter-rouge">provider</code></li>
  <li><code class="language-plaintext highlighter-rouge">placeholder</code></li>
</ol>

<p>å…¶ä¸­</p>

<p><code class="language-plaintext highlighter-rouge">kind</code>æ˜¯<code class="language-plaintext highlighter-rouge">æ ‡è¯†å°éƒ¨ä»¶çš„å­—ç¬¦ä¸²,å¹¶ä¸”åº”æè¿°å°éƒ¨ä»¶æ‰€ä»£è¡¨çš„å†…å®¹ã€‚å³å°éƒ¨ä»¶çš„åŒ…å</code></p>

<p><code class="language-plaintext highlighter-rouge">provider</code>ä¸º<code class="language-plaintext highlighter-rouge">æ—¶é—´çº¿æä¾›è€…</code></p>

<p><code class="language-plaintext highlighter-rouge">PlaceholderView</code>ä¸º<code class="language-plaintext highlighter-rouge">å ä½è§†å›¾</code></p>

<p>åŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">configurationDisplayName()</code>è®¾ç½®å°éƒ¨ä»¶æ˜¾ç¤ºçš„åç§°</li>
  <li><code class="language-plaintext highlighter-rouge">description()</code>è®¾ç½®å°éƒ¨ä»¶çš„æè¿°</li>
  <li><code class="language-plaintext highlighter-rouge">supportedFamilies()</code>è®¾ç½®å°éƒ¨ä»¶æ”¯æŒçš„å°ºå¯¸</li>
</ul>

<blockquote>
  <p>è¿™é‡Œæœ‰ä¸€ä¸ªé‡ç‚¹ï¼Œä¸ºäº†ä½¿æŸä¸ªåº”ç”¨ç¨‹åºçš„çª—å£å°éƒ¨ä»¶å‡ºç°åœ¨çª—å£å°éƒ¨ä»¶åº“ä¸­ï¼Œç”¨æˆ·å¿…é¡»åœ¨å®‰è£…è¯¥åº”ç”¨ç¨‹åºåè‡³å°‘å¯åŠ¨ä¸€æ¬¡åŒ…å«è¯¥çª—å£å°éƒ¨ä»¶çš„åº”ç”¨ç¨‹åºã€‚</p>
</blockquote>

<p><br /></p>

<h2 id="å››widgetentryview">å››ã€WidgetEntryView</h2>

<p>WidgetEntryViewå°±æ˜¯ä½¿ç”¨SwiftUIå¸ƒå±€çš„å°éƒ¨ä»¶è§†å›¾</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct SmileEverydayWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        Text(entry.date, style: .time)
    }
}
</code></pre></div></div>

<p>ä¾‹å¦‚è¿™ä¸ªå°éƒ¨ä»¶è§†å›¾å°±ç®€å•çš„å±•ç¤ºäº†å½“å‰çš„æ—¶é—´</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å°†é»˜è®¤çš„å¸ƒå±€æ›´æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„å¸ƒå±€ï¼Œä¾‹å¦‚æˆ‘åœ¨è®¾ç½®äº†æ˜¾ç¤ºæ–‡æœ¬çš„å­—ä½“å’Œå°éƒ¨ä»¶çš„èƒŒæ™¯å›¾</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct SmileEverydaWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        
        return Text(entry.message)
            .background(Image(entry.backgroundImageStr))
            .font(.callout)
    }
}
</code></pre></div></div>

<p><br /></p>

<h2 id="äº”placeholderview">äº”ã€PlaceholderView</h2>

<p>æ¯ç§å°éƒ¨ä»¶éƒ½éœ€è¦æä¾›å ä½ç¬¦UIã€‚</p>

<p>å ä½ç¬¦UIæ˜¯çª—å£å°éƒ¨ä»¶çš„é»˜è®¤å†…å®¹ã€‚</p>

<p>å®ƒåº”è¯¥ä»£è¡¨æ‚¨çš„å°éƒ¨ä»¶ç±»å‹ï¼Œä½†ä»…æ­¤è€Œå·²ã€‚</p>

<p>æ­¤ç”¨æˆ·ç•Œé¢ä¸­ä¸åº”æœ‰ä»»ä½•ç”¨æˆ·æ•°æ®ã€‚</p>

<p><img src="../images/widget/17.png" alt="Alt text" /></p>

<p>æƒ³è±¡ä¸€ä¸‹</p>

<p>å¦‚æœåœ¨ç”¨æˆ·çš„ä¸»å±å¹•ä¸Šå‡ºç°å¦‚ä¸‹çš„åœºæ™¯ï¼Œé‚£ä¹ˆä½ çš„å°éƒ¨ä»¶ç¦»è¢«ç§»é™¤å¯èƒ½å·²ç»ä¸è¿œäº†</p>

<p><img src="../images/widget/19.png" alt="Alt text" /></p>

<p><br /></p>

<h2 id="å…­timelineentry">å…­ã€TimelineEntry</h2>

<p>æˆ‘ä»¬çŸ¥é“å°éƒ¨ä»¶æ˜¯æŒ‰ç…§æ—¶é—´çº¿æ¥å±•ç¤ºçš„ï¼Œ<code class="language-plaintext highlighter-rouge">TimelineEntry</code>æ—¶é—´çº¿ä¸Šçš„ä¸€ä¸ªä¸ªæ¡ç›®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct SimpleEntry: TimelineEntry {
    public let date: Date
}
</code></pre></div></div>

<p>TimelineEntryæœ‰ä¸€ä¸ªå¿…é¡»æœ‰çš„å±æ€§å°±æ˜¯<code class="language-plaintext highlighter-rouge">date</code>ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ¡ç›®åœ¨æ—¶é—´çº¿ä¸Šçš„å…·ä½“æ—¶é—´</p>

<p>å¦å¤–å¼€å‘è€…å¯ä»¥åœ¨TimelineEntryé‡Œè‡ªå®šä¹‰å„ç§å±æ€§ï¼Œç”¨æ¥ç»™å°éƒ¨ä»¶è§†å›¾æä¾›æ•°æ®</p>

<p>ä¾‹å¦‚æˆ‘åœ¨TimelineEntryé‡Œè‡ªå®šä¹‰äº†<code class="language-plaintext highlighter-rouge">message </code>å’Œ<code class="language-plaintext highlighter-rouge">backgroundImageStr </code>å±æ€§ï¼Œç”¨æ¥æ˜¾ç¤ºå°éƒ¨ä»¶ä¸Šçš„æ–‡å­—å’ŒèƒŒæ™¯å›¾ç‰‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct SimpleEntry: TimelineEntry {
    public let date: Date
    public let message: String
    public let backgroundImageStr : String
}
</code></pre></div></div>

<h2 id="ä¸ƒtimelineprovider">ä¸ƒã€TimelineProvider</h2>

<p><code class="language-plaintext highlighter-rouge">TimelineProvider</code> æ˜¯ä¸€ä¸ªæä¾›äº†ä¸Šè¿°æˆ‘ä»¬æ‰€è¯´çš„<code class="language-plaintext highlighter-rouge">TimelineEntry</code>é›†åˆçš„å¯¹è±¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct Provider: TimelineProvider {
    public typealias Entry = SimpleEntry

    public func snapshot(with context: Context, completion: @escaping (SimpleEntry) -&gt; ()) {
        let entry = SimpleEntry(date: Date())
        completion(entry)
    }

    public func timeline(with context: Context, completion: @escaping (Timeline&lt;Entry&gt;) -&gt; ()) {
        var entries: [SimpleEntry] = []

        // Generate a timeline consisting of five entries an hour apart, starting from the current date.
        let currentDate = Date()
        for hourOffset in 0 ..&lt; 5 {
            let entryDate = Calendar.current.date(byAdding: .hour, value: hourOffset, to: currentDate)!
            let entry = SimpleEntry(date: entryDate)
            entries.append(entry)
        }

        let timeline = Timeline(entries: entries, policy: .atEnd)
        completion(timeline)
    }
}
</code></pre></div></div>

<p>å…¶ä¸­åŒ…å«ä¸¤ä¸ªæ–¹æ³•</p>

<ul>
  <li>snapshot()</li>
  <li>timeline()</li>
</ul>

<h4 id="1snapshot-å¿«ç…§">1ã€snapshot å¿«ç…§</h4>

<p>ä¸ºäº†åœ¨å°éƒ¨ä»¶åº“ä¸­æ˜¾ç¤ºå°éƒ¨ä»¶ï¼ŒWidgetKit è¦æ±‚æä¾›è€…æä¾›é¢„è§ˆå¿«ç…§ï¼Œ å³<code class="language-plaintext highlighter-rouge">snapshot()</code>ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œä¸»è¦æä¾›äº†ä¸€äº›<code class="language-plaintext highlighter-rouge">ç¤ºä¾‹æ•°æ®ï¼Œæœ€å¥½æ˜¯çœŸå®æ•°æ®</code>ï¼Œç”¨äº<code class="language-plaintext highlighter-rouge">æ—¶é—´çº¿ä¸èƒ½å±•ç¤º</code>çš„æ—¶å€™å±•ç¤ºç»™ç”¨æˆ·</p>

<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¿«ç…§æ˜¯ç³»ç»Ÿéœ€è¦å¿«é€Ÿæ˜¾ç¤ºå•ä¸ªæ¡ç›®çš„ä½ç½®ã€‚</p>

<p>å› æ­¤ï¼Œæ‚¨çš„æ‰©å±•ç¨‹åºæœ‰æœ›å°½å¿«è¿”å›è§†å›¾ï¼Œå› ä¸ºè¿™æ ·åšæ—¶ï¼Œæ‚¨ä¼šåœ¨iOSä¸Šæ¼‚äº®çš„Widget Galleryä¸­çœ‹åˆ°çœŸæ­£çš„Widgetã€‚</p>

<p>è¿™ä¸æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡æ—¶å¿…é¡»æä¾›çš„å±å¹•æˆªå›¾æˆ–å›¾åƒã€‚è¿™æ˜¯æ‚¨åœ¨iOSï¼ŒiPadOSå’ŒmacOSä¸ŠçœŸæ­£çš„å°éƒ¨ä»¶ä½“éªŒã€‚</p>

<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ—¶é—´è½´çš„ç¬¬ä¸€ä¸ªæ¡ç›®å’Œå¿«ç…§å¯ä»¥ä½œä¸ºåŒä¸€æ¡ç›®è¿”å›ï¼Œå› æ­¤ï¼Œåœ¨â€œå°å·¥å…·åº“â€ä¸­çœ‹åˆ°çš„å°±æ˜¯ç”¨æˆ·å°†å…¶æ·»åŠ åˆ°è®¾å¤‡ä¸­æ—¶å¾—åˆ°çš„å†…å®¹ã€‚</p>

<p><img src="../images/widget/20.png" alt="Alt text" /></p>

<p>ä¾‹å¦‚æˆ‘ä»¬åœ¨Widget Galleryä¸­æ·»åŠ ç”µæ± å°éƒ¨ä»¶æ—¶ï¼Œå°éƒ¨ä»¶æ­¤æ—¶åœ¨Widget Galleryä¸­å±•ç¤ºçš„å°±æ˜¯å½“å‰è®¾å¤‡ç”µæ± ä¿¡æ¯çš„å®æ—¶æ•°æ®çš„å¿«ç…§ï¼Œè€Œä¸æ˜¯ä¸€äº›è™šå‡çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°éƒ¨ä»¶çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·å­ï¼Œç”¨æˆ·æ·»åŠ åˆ°ä¸»å±å¹•ä¸Šä¹‹åå°éƒ¨ä»¶çš„æ•°æ®å°±æ˜¯ä»€ä¹ˆæ ·å­ï¼Œä»è€Œæé«˜ç”¨æˆ·çš„ä½“éªŒã€‚</p>

<blockquote>
  <p>å¯¹æ¯”</p>
</blockquote>

<p>å°éƒ¨ä»¶é‡Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒç±»ä¼¼çš„æ¦‚å¿µï¼Œ<code class="language-plaintext highlighter-rouge">PlaceholderView</code>å’Œ<code class="language-plaintext highlighter-rouge">snapshot</code>ï¼Œéƒ½æ˜¯ä¸€ç§å ä½è§£å†³æ–¹æ¡ˆï¼Œä¸åŒçš„æ˜¯<code class="language-plaintext highlighter-rouge">PlaceholderView</code>æ˜¯åœ¨ä¸»å±å¹•ä¸Šæ— æ³•å¿«é€Ÿè·å–æ•°æ®æ—¶çš„ä¸€ç§å ä½è§†å›¾ï¼Œä¸è‡³äºæ˜¾ç¤ºloadingæˆ–è€…ç™½å±ç»™ç”¨æˆ·çœ‹ï¼›è€Œ<code class="language-plaintext highlighter-rouge">snapshot</code>ä¸»è¦ç”¨äº<code class="language-plaintext highlighter-rouge">Widget Gallery</code>ä¸­ï¼Œç”¨æ¥æé«˜ç”¨æˆ·ä½“éªŒçš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œ<code class="language-plaintext highlighter-rouge">snapshot </code>å°±æ˜¯æ—¶é—´çº¿çš„ç¬¬ä¸€å¸§</p>

<h4 id="2timeline">2ã€timeline</h4>

<p>åœ¨è¯·æ±‚åˆå§‹å¿«ç…§åï¼ŒWidgetKitè°ƒç”¨<code class="language-plaintext highlighter-rouge">timeline</code>ä»¥è¯·æ±‚æä¾›è€…çš„å¸¸è§„æ—¶é—´è½´ã€‚æ—¶é—´è½´ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ—¶é—´è½´æ¡ç›®<code class="language-plaintext highlighter-rouge">TimelineEntry</code>ä»¥åŠä¸€ä¸ªé‡è½½ç­–ç•¥<code class="language-plaintext highlighter-rouge">ReloadPolicy</code>ç»„æˆï¼Œè¯¥é‡è½½ç­–ç•¥é€šçŸ¥WidgetKitä½•æ—¶è¯·æ±‚åç»­æ—¶é—´è½´ã€‚</p>

<p>å…³äºé‡è½½ç­–ç•¥ï¼Œæä¾›äº†ä»¥ä¸‹å‡ ç§ç­–ç•¥</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">atEnd</code>: æ˜¯æŒ‡ Timeline æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶å€™å†åˆ·æ–°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">atAfter</code>: æ˜¯æŒ‡åœ¨æŸä¸ªæ—¶é—´ä»¥åæœ‰è§„å¾‹çš„åˆ·æ–°</li>
  <li><code class="language-plaintext highlighter-rouge">never</code>ï¼šæ˜¯æŒ‡ä»¥åä¸éœ€è¦åˆ·æ–°äº†ã€‚ä»€ä¹ˆæ—¶å€™éœ€è¦é‡æ–°åˆ·æ–°éœ€è¦ App é‡æ–°å‘ŠçŸ¥ Widget</li>
</ul>

<p>æ ¹æ®ä¸Šè¾¹çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å°†<code class="language-plaintext highlighter-rouge">TimelineProvider </code>æ”¹é€ å¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct Provider: TimelineProvider {
    public typealias Entry = SimpleEntry

    public func snapshot(with context: Context, completion: @escaping (SimpleEntry) -&gt; ()) {
        let date = Date()
        let message = "è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚"
        let backgroundImageStr = "bg7"
        
        
        let entry = SimpleEntry(date: date, message: message, backgroundImageStr: backgroundImageStr)
        completion(entry)
    }

    public func timeline(with context: Context, completion: @escaping (Timeline&lt;Entry&gt;) -&gt; ()) {
        var entries: [SimpleEntry] = []
        
        var currentDate = Date()
        var nextUpdateDate = Calendar.current.date(byAdding: .second, value: 3, to: currentDate)!
        
        let message = "è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚\næº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ï¼›æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚\nè’¹è‘­å‡„å‡„ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚"
        let backgroundImageStr = "bg"
        
        
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy-MM-dd HH:mm:ss"
        var currentDateStr = ""
        var nextUpdateDateStr = ""

        let longUuid = UUID().uuidString
        let range: Range = longUuid.range(of: "-")!
        let location: Int = longUuid.distance(from: longUuid.startIndex, to: range.lowerBound)
        let uuid = longUuid.prefix(location)
        
        for i in 1 ..&lt; 10 {
            
            var msg = ""
            
            currentDate = nextUpdateDate;
            nextUpdateDate = Calendar.current.date(byAdding: .second, value: 3, to: currentDate)!
            
            currentDateStr = formatter.string(from: currentDate)
            nextUpdateDateStr = formatter.string(from: nextUpdateDate)
            
            msg.append(message)
            msg.append("\næ—¶é—´è½´ID " + uuid);
            msg.append("\næ—¶é—´è½´ç¬¬" + String(i+1) + "ä¸ªè§†å›¾")
            msg.append("\næœ¬æ¬¡è§†å›¾å¼€å§‹æ—¶é—´ " + currentDateStr)
            msg.append("\nä¸‹æ¬¡è§†å›¾å¼€å§‹æ—¶é—´ " + nextUpdateDateStr)
            
            let entry = SimpleEntry(date: currentDate, message: msg, backgroundImageStr: backgroundImageStr+String(i))
            
            entries.append(entry)
            print(String(i))
        }
        
        let timeline = Timeline(entries: entries, policy: .atEnd)
        completion(timeline)
    }
}
</code></pre></div></div>

<p>è¿™æ®µä»£ç é‡Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¤è¯—è¯çš„å¿«ç…§</p>

<p>å¹¶ç”Ÿæˆäº†ä¸€ä¸ªæ—¶é—´çº¿ï¼Œå…¶ä¸­æ—¶é—´çº¿é‡ŒåŒ…å«äº†<code class="language-plaintext highlighter-rouge">10ä¸ªentryï¼Œä¸”æ¯ä¸ªentry é—´éš”3s</code></p>

<p>entryæ–‡æœ¬æ‹¼æ¥æ˜¾ç¤ºäº†</p>

<ul>
  <li>è¯—ç»</li>
  <li>æ—¶é—´è½´ID</li>
  <li>æœ¬æ¬¡è§†å›¾å¼€å§‹æ—¶é—´</li>
  <li>ä¸‹æ¬¡è§†å›¾å¼€å§‹æ—¶é—´</li>
</ul>

<p>ä¸‹è¾¹æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çœŸå®runå‡ºæ¥çš„æ•ˆæœ</p>

<p>&lt;img src=â€../images/widget/21.gifâ€ alt=â€å›¾ç‰‡æ›¿æ¢æ–‡æœ¬â€ width=50% height=50% align=â€centerâ€ /&gt;</p>
:ET